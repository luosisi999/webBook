# 计算机网络

这章主要介绍一些计算机网络中最最最最基本概念，也是最最最最高频的考点，一定得弄清原理、熟练表述出来。

HTTP相关的东西放到下一章单列出来了，这一章的内容有：

- [网络模型和网络协议](#网络模型和网络协议)
- [TCP握手挥手](#TCP握手挥手)
- [TCP和UDP](#TCP和UDP)

## <a id="网络模型和网络协议">网络模型和网络协议</a>
**一、OSI七层模型、TCP/IP概念层模型**

![](\Images\网络模型.jpg)

区别：OSI模型注重通信协议必要的功能是什么，TCP/IP模型更强调在计算机上实现协议应该开发哪种程序。

**二、应用层的网络协议**

- FTP：文本传输协议  
- SMTP：简单邮件传输协议  
- TELNET：Internet远程登录服务的标准协议和主要方式  
- HTTP：超文本传输协议  
- TFTP：简单文件传输协议  
- DNS：域名系统  
- SNMP：简单网络管理协议  
- NFS：网络文件系统

**三、数据的单位**

- 包：全能性术语
- 帧：数据链路层中包的单位
- 数据包：网络层以上的分层中包的单位
- 段：TCP数据流中的信息
- 消息：应用协议中数据的单位

**四、地址**

- MAC地址：数据链路中的地址，用来识别同一链路中不同的计算机
- IP地址：IP中的地址，用来识别连接到网络中的主机和路由器
- 程序地址（端口号）：识别同一台计算机中进行通信的不同应用程序

## <a id="TCP和UDP">TCP和UDP</a>

**一、TCP和UDP的区别**

|                    TCP                     |                             UDP                              |
| :----------------------------------------: | :----------------------------------------------------------: |
|            面向连接的可靠性传输            |                         无连接不可靠                         |
| 保证数据的无差错、不丢失、不重传且按序到达 |               尽最大努力交付，但不保证可靠交付               |
|                 面向字节流                 |                           面向报文                           |
|                只能是一对一                |                        一对一或一对多                        |
|              首部较大有20字节              |                        首部只有8字节                         |
|           用于需要可靠传输的情况           | 用于高速传输和对实时性有较高要求的通信（视频、音频等多媒体通信）或广播通信 |

TCP特点：流量控制、拥塞控制、面向连接、可靠传输

**二、TCP滑动窗口和拥塞窗口比较**

1. 滑动窗口：发送方+接收方

   解决发送方和接收方收发数据速率不一致的问题。滑动窗口相当于接收方的缓存，接收方向发送方通知自己可接受数据的大小，而发送方会根据这个数值发送数据

2. 拥塞窗口：发送方

   控制全局网络的拥塞情况。通过控制发送方每次发送的流量多少，来逐渐试探整体网络的拥塞程度。

   如果没有拥塞控制，发送方每次发送的数据大小为滑动窗口，在只有两台主机的时候没有问题，但在现实的网络大环境中，如果每台主机都发送滑动窗口大小的数据，那整个网络系统必然会瘫痪，所以通过在发送方设置拥塞窗口，可以有效缓解网络压力。

**三、TCP拥塞控制**

慢启动+拥塞避免；快速重传+快速恢复

- 慢启动：防止一开始速率过快，导致耗尽中间路由器存储空间，从而严重降低TCP连接的吞吐量
- 拥塞避免：当拥塞发生时，降低网络传输速率
- 快速重传：在接收到相同ACK后，推断出丢失报文段起始序号，然后立即重传此报文
- 快速恢复：在快速重传基础上，如果发生了快速重传，则执行拥塞避免算法而非慢启动

## <a id="TCP握手挥手">TCP握手挥手</a>

首先，来认识一下握手挥手中用到的一些标识位和缩写的含义：

- SYN：标识位，表示建立链接
- ACK：标识位，表示响应
- FIN：标识位，表示关闭链接
- seq：顺序号码（TCP连接中传送的字节流中的每个字节都按顺序编号）
- ack：确认号码，是期望收到对方下一个报文的第一个数据字节的序号

TCP三次握手：客户端和服务器都需要知道双方可收发，因此需要三次握手（让我知道你已经知道了）  
![](\Images\TCP握手.png)  TCP客户端最后还要发送一次确认的目的：防止已经失效的连接请求报文突然又传送到服务器，从而导致不必要的错误和资源的浪费。

TCP四次挥手：  
![](\Images\TCP挥手.png)  TCP客户端最后还要等待2*MSL（最长报文段寿命）的目的：保证客户端发送的最后一个ACK报文能够达到服务器；防止已经失效的关闭连接报文段出现在本连接中。

Q1：如果已经建立了连接，但客户端突然出现故障怎么办？

TCP设有一个保活计时器，服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常设置为2h，若2h之内还没有收到客户端的任何数据，服务器就会发送一个探测报文，之后每隔75s发送一次。若连续发送10个探测报文仍没有回应，服务器就认为客户端出现故障，接着就关闭连接。

Q2：为什么建立连接是三次握手，关闭连接是四次挥手？

建立连接的时候，服务器出于监听状态，一旦收到客户端建立连接请求的SYN报文后，可直接将SYN和ACK放在一个报文中返回客户端。

而关闭连接时，服务器收到客户端关闭连接的FIN报文时仅仅表示对方不再发送数据但仍能接受数据，而自己的数据也未必全部发送给对方了，所以此时发送完数据给对方后，再向客户端发送FIN报文来表示同意现在关闭连接，ACK和FIN的分开发送导致挥手比握手多了一次。



参考：[两张动图-彻底明白TCP的三次握手与四次挥手](https://blog.csdn.net/qzcsu/article/details/72861891)（这篇博客讲的非常好，大家可以看看原文加深理解）
### HTTP请求过程
浏览器发起请求——>解析域名得到IP进行TCP连接——>浏览器发送HTTP请求和头信息发送——>服务器对浏览器进行应答，响应头信息和浏览器所需的内容——>浏览器得到数据进行操作——>关闭TCP连接
